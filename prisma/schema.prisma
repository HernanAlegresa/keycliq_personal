generator client {
provider = "prisma-client-js"
}


datasource db {
provider = "postgresql"
url = env("DATABASE_URL")
}


model User {
id String @id @default(cuid())
email String @unique
password String
role Role @default(USER)
sessions Session[]
keys Key[]
passwordResetTokens PasswordResetToken[]
createdAt DateTime @default(now())
updatedAt DateTime @updatedAt
}


enum Role {
USER
ADMIN
}


model Session {
id String @id @default(cuid())
userId String
user User @relation(fields: [userId], references: [id], onDelete: Cascade)
expiration DateTime
createdAt DateTime @default(now())
}


model PasswordResetToken {
  id String @id @default(cuid())
  userId String
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  tokenHash String @unique
  expiresAt DateTime
  used Boolean @default(false)
  createdAt DateTime @default(now())
}

model Key {
  id String @id @default(cuid())
  userId String
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  name String
  description String?
  unit String? // Unidad opcional
  door String? // Puerta opcional
  notes String? // Notas opcionales
  imageUrl String? // URL de la imagen en Cloudinary
  imagePublicId String? // Public ID de Cloudinary para gestión
  signature Json? // Vector de características
  sigStatus String @default("pending") // 'pending' | 'ready' | 'failed'
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("keys")
}

