import{a as Y}from"/build/_shared/chunk-GEIFXFKC.js";import{b as Q}from"/build/_shared/chunk-DCFNNAFJ.js";import{a as W}from"/build/_shared/chunk-NS5VKCTN.js";import{a as q}from"/build/_shared/chunk-OWLHX2XX.js";import{a as w}from"/build/_shared/chunk-6NNHUWD2.js";import{a as O}from"/build/_shared/chunk-NDLLOLF7.js";import{a as H}from"/build/_shared/chunk-PGOH7JLP.js";import{b as B,c as M,i as D,n as F,o as L}from"/build/_shared/chunk-VHMXRLU6.js";import{a as S,b as _}from"/build/_shared/chunk-4HXKWYDW.js";import{c as i}from"/build/_shared/chunk-Q3IECNXJ.js";var P=i(H(),1);var n=i(S(),1),G=i(O(),1),p=i(W(),1);var A=i(S(),1),m=i(_(),1);function z({src:f,alt:a="Key image",isOpen:k,onClose:u}){(0,A.useEffect)(()=>{let l=U=>{U.key==="Escape"&&u()};return k&&(document.addEventListener("keydown",l),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",l),document.body.style.overflow="unset"}},[k,u]);let o=l=>{l.target===l.currentTarget&&u()};return k?(0,m.jsx)("div",{className:"image-modal",onClick:o,children:(0,m.jsxs)("div",{className:"image-modal__content",children:[(0,m.jsx)("button",{className:"image-modal__close",onClick:u,"aria-label":"Close image modal",children:(0,m.jsx)("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,m.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,m.jsx)("img",{src:f,alt:a,className:"image-modal__img"})]})}):null}var j=i(q(),1),T=i(Y(),1),e=i(_(),1),J={hideFooter:!0,title:"Key Details",showBackButton:!0,backTo:"dynamic"};function R(){let f=B(),{isNewKey:a,imageUrl:k,imageDataUrl:u,key:o}=F(),l=L(),I=M().state==="submitting",{setRightSlot:c}=Q(),K=a?{name:"",property:"",unit:"",door:"",notes:"",imageUrl:"/api/placeholder/200x150",imageDataUrl:null}:{name:o?.name||"",property:o?.description||"",unit:o?.unit||"",door:o?.door||"",notes:o?.notes||"",imageUrl:o?.imageUrl?`/api/key-image/${o.id}`:"/api/placeholder/200x150",imageDataUrl:null},[t,v]=(0,n.useState)(K),[r,$]=(0,n.useState)(K),[d,y]=(0,n.useState)(a),[x,h]=(0,n.useState)(a),[V,C]=(0,n.useState)(!1),E=t.name.trim()!==""&&t.property.trim()!=="";(0,n.useEffect)(()=>{if(a){let s=sessionStorage.getItem("tempKeyImageDataURL"),b=sessionStorage.getItem("tempKeyImage");s&&s.startsWith("data:")&&v(N=>({...N,imageUrl:b||"/api/placeholder/200x150",imageDataUrl:s}))}},[a]),(0,n.useEffect)(()=>{let s=t.name!==r.name||t.property!==r.property||t.unit!==r.unit||t.door!==r.door||t.notes!==r.notes;h(s)},[t,r]),(0,n.useEffect)(()=>{l?.success&&!a&&(y(!1),h(!1),$(t))},[l?.success,a,t]),(0,n.useEffect)(()=>(c(a?null:d?(0,e.jsx)("button",{className:"key-details__cancel-button-header",onClick:()=>{v(r),y(!1),h(!1)},children:"Cancel"}):(0,e.jsx)("button",{className:"key-details__edit-button-header",onClick:()=>y(!0),children:"Edit"})),()=>c(null)),[a,d,c]);let g=(s,b)=>{v(N=>({...N,[s]:b}))},X=()=>{y(!0)},Z=()=>{},ee=()=>{},ae=()=>{v(r),y(!1),h(!1)},te=()=>{f(a?"/scan/new":"/keys")};return(0,e.jsxs)("div",{className:"key-details",children:[(0,e.jsxs)("div",{className:"key-details__content",children:[(0,e.jsx)("div",{className:"key-details__image-container",children:(0,e.jsx)("img",{src:t.imageUrl,alt:t.name,className:"key-details__image",onClick:()=>C(!0)})}),(0,e.jsxs)(D,{method:"post",encType:"multipart/form-data",id:"key-form",children:[(0,e.jsx)("input",{type:"hidden",name:"intent",value:"save"}),t.imageDataUrl&&(0,e.jsx)("input",{type:"hidden",name:"imageDataUrl",value:t.imageDataUrl}),(0,e.jsxs)("div",{className:"key-details__form",children:[(0,e.jsxs)("div",{className:"key-details__field",children:[(0,e.jsxs)("label",{className:"key-details__label",children:["Key Name",(0,e.jsx)("span",{className:"key-details__required",children:"*"})]}),(0,e.jsx)("input",{type:"text",name:"name",value:t.name,onChange:s=>g("name",s.target.value),placeholder:a?"E.g., Front Door Garage Key":"",className:"key-details__input",disabled:!d})]}),(0,e.jsxs)("div",{className:"key-details__field",children:[(0,e.jsxs)("label",{className:"key-details__label",children:["Property",(0,e.jsx)("span",{className:"key-details__required",children:"*"})]}),(0,e.jsx)("p",{className:"key-details__hint",children:"Ensure the property name is input consistently for best organization."}),(0,e.jsx)("input",{type:"text",name:"property",value:t.property,onChange:s=>g("property",s.target.value),placeholder:a?"E.g., 123 Main St.":"",className:"key-details__input",disabled:!d})]}),(0,e.jsxs)("div",{className:"key-details__field",children:[(0,e.jsx)("label",{className:"key-details__label",children:"Unit (optional)"}),(0,e.jsx)("input",{type:"text",name:"unit",value:t.unit,onChange:s=>g("unit",s.target.value),placeholder:a?"E.g., Unit 4":"",className:"key-details__input",disabled:!d})]}),(0,e.jsxs)("div",{className:"key-details__field",children:[(0,e.jsx)("label",{className:"key-details__label",children:"Door (optional)"}),(0,e.jsx)("input",{type:"text",name:"door",value:t.door,onChange:s=>g("door",s.target.value),placeholder:a?"E.g., Front door":"",className:"key-details__input",disabled:!d})]}),(0,e.jsxs)("div",{className:"key-details__field",children:[(0,e.jsx)("label",{className:"key-details__label",children:"Notes (optional)"}),(0,e.jsx)("textarea",{name:"notes",value:t.notes,onChange:s=>g("notes",s.target.value),placeholder:a?"Add any notes about the key":"",className:"key-details__textarea",disabled:!d,rows:4})]})]})]})]}),(0,e.jsxs)("div",{className:"key-details__actions",children:[!a&&(0,e.jsxs)(D,{method:"post",children:[(0,e.jsx)("input",{type:"hidden",name:"intent",value:"delete"}),(0,e.jsx)(w,{variant:"secondary",size:"large",type:"submit",onClick:s=>{confirm("Are you sure you want to delete this key? This action cannot be undone.")||s.preventDefault()},className:"key-details__delete-button",children:"Delete"})]}),(0,e.jsx)(w,{variant:"primary",size:"large",type:"submit",form:"key-form",disabled:!d||!E||!x||I,className:`key-details__save-button ${a?"key-details__save-button--full-width":""}`,children:I?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("span",{className:"loading-spinner"}),a?"Saving Key...":"Saving..."]}):a?"Save Key":"Save"})]}),(0,e.jsx)(z,{src:t.imageUrl,alt:t.name,isOpen:V,onClose:()=>C(!1)})]})}export{R as default,J as handle};
