import{a as S}from"/build/_shared/chunk-3WSEGTLN.js";import{a as I}from"/build/_shared/chunk-6NNHUWD2.js";import{a as R}from"/build/_shared/chunk-NDLLOLF7.js";import{a as F}from"/build/_shared/chunk-PGOH7JLP.js";import{b as C,n as w}from"/build/_shared/chunk-VHMXRLU6.js";import{a as b,b as f}from"/build/_shared/chunk-4HXKWYDW.js";import{c as i}from"/build/_shared/chunk-Q3IECNXJ.js";var G=i(F(),1);var n=i(b(),1),T=i(R(),1);var y=i(b(),1),t=i(f(),1),A="/scan-guide-key.png";function x(){let[l,d]=(0,y.useState)(!1),[p,m]=(0,y.useState)(!1),u=A,r="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='720' height='480' viewBox='0 0 720 480'%3E%3Crect width='720' height='480' fill='%23f3f4f6'/%3E%3Cpath d='M120 120h480v240H120z' fill='none' stroke='%23d1d5db' stroke-width='8' stroke-dasharray='16 18'/%3E%3Cpath d='M240 240c0-52.996 43.004-96 96-96s96 43.004 96 96-43.004 96-96 96-96-43.004-96-96z' fill='none' stroke='%239ca3af' stroke-width='14' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E";return(0,t.jsx)("div",{className:"scan-guidelines scan-guidelines--inline",children:(0,t.jsxs)("div",{className:"scan-guidelines__card",children:[(0,t.jsx)("div",{className:"scan-guidelines__header",children:(0,t.jsx)("h2",{className:"scan-guidelines__header-title",children:"Scanning Tips"})}),(0,t.jsx)("div",{className:"scan-guidelines__list",children:[{icon:"\u2194\uFE0F",title:"Horizontal Position",description:null},{icon:"\u{1F448}",title:"Bow on Left",description:null},{icon:"\u2B06\uFE0F",title:"Teeth Facing Up",description:null},{icon:"\u{1F4A1}",title:"Good Lighting",description:null},{icon:"\u{1F50D}",title:"Zoom for better focus",description:"Make a small zoom to improve sharpness and get a clearer key image. Avoid taking the photo too close or too far."}].map((o,c)=>(0,t.jsxs)("div",{className:"scan-guidelines__item",children:[(0,t.jsx)("div",{className:"scan-guidelines__icon",children:o.icon}),(0,t.jsxs)("div",{className:"scan-guidelines__content",children:[(0,t.jsx)("h3",{className:"scan-guidelines__item-title",children:o.title}),o.description&&(0,t.jsx)("p",{className:"scan-guidelines__item-description",children:o.description})]})]},c))}),(0,t.jsx)("div",{className:"scan-guidelines__example",children:(0,t.jsxs)("div",{className:"scan-guidelines__example-image",children:[(0,t.jsx)("div",{className:`scan-guidelines__image-skeleton ${l?"is-hidden":""}`,"aria-hidden":"true"}),(0,t.jsx)("picture",{children:(0,t.jsx)("img",{src:p?r:u,alt:"Example of properly positioned key for scanning",className:"scan-guidelines__key-image",loading:"lazy",decoding:"async",onLoad:()=>d(!0),onError:()=>{m(!0),d(!0)}})})]})})]})})}var e=i(f(),1),P={hideFooter:!0,title:"Scan a Key",stepLabel:"1 of 2",showBackButton:!0,backTo:"/"};function E(){let{demoMode:l}=w(),d=C(),p=(0,n.useRef)(null),m=(0,n.useRef)(null),u=(0,n.useRef)(null),r=(0,n.useRef)(null),[h,o]=(0,n.useState)(null),[c,N]=(0,n.useState)(!1),[g,_]=(0,n.useState)(!1),[L,U]=(0,n.useState)(!1),[z,v]=(0,n.useState)(!1);(0,n.useEffect)(()=>{if(!l){v(!1);return}let a=localStorage.getItem("keycliq_hide_demo_notice")==="1";v(!a)},[l]),(0,n.useEffect)(()=>{let a=()=>{U(window.innerWidth>=768)};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]),(0,n.useEffect)(()=>{let a=s=>{r.current&&!r.current.contains(s.target)&&_(!1)};if(g)return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[g]);let k=async a=>{if(a){if(!a.type.startsWith("image/")){o("Please select an image file");return}if(a.size>10*1024*1024){o("File size must be less than 10MB");return}o(null),N(!0),_(!1);try{let s=await S(a),D=URL.createObjectURL(a);sessionStorage.setItem("tempKeyImage",D),sessionStorage.setItem("tempKeyImageDataURL",s),sessionStorage.setItem("tempKeyImageName",a.name),d("/scan/review")}catch(s){console.error("Error processing image:",s),o("Failed to process image"),N(!1)}}};return(0,e.jsxs)("div",{className:"scan-capture",children:[(0,e.jsxs)("div",{className:"scan-capture__actions scan-capture__actions--top",children:[(0,e.jsxs)("div",{className:"scan-capture__action-wrapper",ref:r,children:[(0,e.jsx)(I,{variant:"primary",size:"large",onClick:()=>{_(!g)},disabled:c,className:"w-full py-3 rounded-2xl",children:"SCAN"}),g&&(0,e.jsxs)("div",{className:"scan-action-selector",children:[(0,e.jsxs)("button",{type:"button",onClick:()=>{p.current?.click()},className:"scan-action-selector__option",disabled:c,children:[(0,e.jsx)("span",{className:"scan-action-selector__icon",children:"\u{1F4F8}"}),(0,e.jsx)("span",{className:"scan-action-selector__text",children:"Take a Photo"})]}),(0,e.jsxs)("button",{type:"button",onClick:()=>{m.current?.click()},className:"scan-action-selector__option",disabled:c,children:[(0,e.jsx)("span",{className:"scan-action-selector__icon",children:"\u{1F5BC}\uFE0F"}),(0,e.jsx)("span",{className:"scan-action-selector__text",children:"Choose from Gallery"})]}),L&&(0,e.jsxs)("button",{type:"button",onClick:()=>{u.current?.click()},className:"scan-action-selector__option",disabled:c,children:[(0,e.jsx)("span",{className:"scan-action-selector__icon",children:"\u{1F4C1}"}),(0,e.jsx)("span",{className:"scan-action-selector__text",children:"Upload File"})]})]})]}),h&&(0,e.jsx)("p",{className:"text-red-600 text-sm text-center",role:"alert",children:h})]}),l&&z&&(0,e.jsxs)("div",{style:{background:"#fff7ed",border:"1px solid #fdba74",color:"#9a3412",borderRadius:"0.75rem",padding:"0.9rem",margin:"0.75rem 0 1rem 0"},children:[(0,e.jsx)("p",{style:{margin:0,fontSize:"0.9rem",lineHeight:1.35},children:"Demo mode: AI key scanning is disabled (no OpenAI API key configured). Scan results are simulated for portfolio purposes."}),(0,e.jsx)("button",{type:"button",onClick:()=>{localStorage.setItem("keycliq_hide_demo_notice","1"),v(!1)},style:{marginTop:"0.5rem",fontSize:"0.82rem",color:"#9a3412",textDecoration:"underline",background:"transparent",border:"none",cursor:"pointer",padding:0},children:"Don't show again"})]}),(0,e.jsx)(x,{}),(0,e.jsx)("input",{ref:p,type:"file",accept:"image/*",capture:"environment",onChange:a=>{let s=a.target.files?.[0];s&&k(s)},className:"scan-capture__file-input","aria-label":"Take a photo"}),(0,e.jsx)("input",{ref:m,type:"file",accept:"image/*",onChange:a=>{let s=a.target.files?.[0];s&&k(s)},className:"scan-capture__file-input","aria-label":"Choose from gallery"}),(0,e.jsx)("input",{ref:u,type:"file",accept:"image/*",onChange:a=>{let s=a.target.files?.[0];s&&k(s)},className:"scan-capture__file-input","aria-label":"Upload file"})]})}export{E as default,P as handle};
